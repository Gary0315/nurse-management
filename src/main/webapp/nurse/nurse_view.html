<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="../css/nurse_view.css">
   <script src="../jquery-3.6.0.js"></script>
   <title>Document</title>
</head>

<body>
   <div class="btn">
      <button id="save"><a href="#">儲存</a></button>
      <button id="back"><a href="./nurse.html">返回</a></button>

   </div>

   <h3 id="empNumber">員工編號<input type="text" name="empid" value="" readonly="true"></h3><br>
   <h3 id="nurseName">護士姓名<input type="text" name="empname" value=""></h3>
   <br><br>
   <h3>分配站點</h3>
   <div class="row">
      <div class="column">
         <table class="site-table" id="nowSite">
            <tr>
               <th>已加入站點</th>
            </tr>
         </table>
      </div>
      <div class="column">
         <button id="btn_new">&#8592;加入</button><br><br><br><br>
         <button id="btn_remove">移除&#8594;</button>
      </div>
      <div class="column">
         <table class="site-table" id="noSite">
            <tr>
               <th>所有站點</th>
            </tr>
         </table>
      </div>
   </div>
   <script>

      $("input[name=empid]").val(localStorage.getItem("UpdateId"))
      $("input[name=empname]").val(localStorage.getItem("UpdateName"))
   
      $(document).ready(function(){
    	  $.ajax({
  			url: `http://localhost:8080/api/nursesite/nurse/${localStorage.getItem("UpdateId")}/`,
  			dataType: 'json',
  			success: function (data) {
  				for(var i=0;i<data.length;i++){
  					$.ajax({
  		    			url: `http://localhost:8080/api/site/${data[i].nursesiteDoublePK.siteid}/`,
  		    			dataType: 'json',
  		    			success: function (data) {
  		    				console.log(data);
  		    					$("#nowSite").append(
  		    	  	    		    	 ` <tr><td>${data.sitename}</td></tr>`
  		    	  	    		      );   					
  		    			}
  		    		}); 
  				}			
  			}
  		});
    	  //所有站點
    	  $.ajax({
    			url: `http://localhost:8080/api/site/`,
    			dataType: 'json',
    			success: function (data) {
    				for(var i=0;i<data.length;i++){
    					$("#noSite").append(
    	  	    		    	 ` <tr><td>${data[i].sitename}</td></tr>`
    	  	    		      );   
    				}			
    			}
    		});
    	  
    	  
      });
    
      //修改
      save.onclick=(
     	     function(){
          		 $.ajax({
                       url: `http://localhost:8080/api/nurse/${localStorage.getItem("UpdateId")}/`,
                       type:'put',
                       data: JSON.stringify({
                       	  "empid":localStorage.getItem("UpdateId"),
                          "empname": $("input[name=empname]").val(),
                          "changetime":new Date()
                       }),
                       contentType: "application/json; charset=utf-8",
                       dataType: 'json',
                       success: function (data) {           	   
                     	  alert("修改成功");
                       }
                   });
          }		 
      )
      
      
      
      //加入未加入狀態轉換
      $(".site-table").on("click", "td", function () {
         if ($(this).hasClass("selected")) {
            $(this).removeClass('selected')
         } else {
            $(this).addClass('selected');
         }
      });

      $("#btn_new").on("click", function () {
         $("#noSite tr ").each(function (index, elem) {
            $("#nowSite").append(`<tr>${$(elem).find("td.selected").closest("tr").html()}</tr>`);
            // $("#nowSite").append(`<tr>${$("#noSite").find("td.selected").closest("tr").html()}</tr>`);
            $("#nowSite").find("td.selected").removeClass('selected')
           // $("#noSite").find("td.selected").closest("tr").remove()
         })
      });

      $("#btn_remove").on("click", function () {
         $("#nowSite tr ").each(function (index, elem) {
            //$("#noSite").append(`<tr>${$(elem).find("td.selected").closest("tr").html()}</tr>`);
          //$("#noSite").append(`<tr>${$("#nowSite").find("td.selected").closest("tr").html()}</tr>`);
            //$("#noSite").find("td.selected").removeClass('selected')
            $("#nowSite").find("td.selected").closest("tr").remove()
         })
      });

   </script>


</body>

</html>